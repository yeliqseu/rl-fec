#!/bin/bash
awk '$1~/Client/ {split($2,a,"."); hostid=a[3]; if (seen[hostid]==0) {seen[hostid]=1; nhost+=1}}; $6~/SendPacket/ {if ($9=="SOURCE") {src_stime[hostid,$11]=$4; nsrc[hostid]+=1}; if ($9=="REPAIR") {rep_stime[hostid,$11]=$4; nrep[hostid]+=1}} $6~/PacketReceive/ {if ($8=="source") {src_rtime[hostid,$11]=$4}; if ($8=="repair") {rep_rtime[hostid,$11]=$4}} $6~/DecoderSuccess/ {for (i=$14;i<=$16;i++) {delivertime[hostid,i]=$4}; delay=$16-$14; if (delay>0) {sumdelay[hostid]+=delay; nbusy[hostid]+=1}} $6~/\[ACK/ {if ($11=="SOURCE") {src_acktime[hostid,$13]=$4}; if ($11=="REPAIR") {rep_acktime[hostid,$13]=$4}} END {for (h=1;h<=nhost;h++) {for (i=0;i<nsrc[h];i++) {if (src_rtime[h,i]==0) {src_rtime[h,i]=-1; src_acktime[h,i]=-1}; print i, src_stime[h,i], src_rtime[h,i], src_acktime[h,i], delivertime[h,i]};}}' $1 > $2
